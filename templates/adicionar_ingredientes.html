{% extends "base.html" %}

{% block title %}
    Adicionar Ingredientes - {{ receita['nome'] }}
{% endblock %}

{% block subtitle %}
    Adicionando ingredientes a: {{ receita['nome'] }}
{% endblock %}

{% block content %}
<div class="card">
    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 1.5rem; flex-wrap: wrap; gap: 1rem;">
        <h1>{{ receita['nome'] }}</h1>
        <a href="{{ url_for('ver_receita', receita_id=receita['id']) }}" class="btn btn-secondary">
            üëÅÔ∏è Ver Resumo da Receita
        </a>
    </div>

    <h2>ü•Ñ Adicionar Novo Ingrediente</h2>
    <form method="POST">
        <div class="form-group">
            <label for="nome_ingrediente">Ingrediente:</label>
            <input type="text"
                   name="nome_ingrediente"
                   id="nome_ingrediente"
                   placeholder="Ex: leite condensado, chocolate em p√≥..."
                   required>
        </div>

        <div class="form-row">
            <div class="form-group" style="flex: 2;">
                <label for="quantidade">Quantidade:</label>
                <input type="number"
                       step="any"
                       name="quantidade"
                       id="quantidade"
                       placeholder="Ex: 395, 200, 1..."
                       required>
            </div>

            <div class="form-group" style="flex: 1;">
                <label for="unidade">Unidade:</label>
                <select name="unidade" id="unidade" required>
                    <option value="">Selecione</option>
                    <option value="g">Gramas (g)</option>
                    <option value="kg">Quilogramas (kg)</option>
                    <option value="ml">Mililitros (ml)</option>
                    <option value="l">Litros (l)</option>
                    <option value="colher">Colher de Sopa</option>
                    <option value="x√≠cara">X√≠cara</option>
                    <option value="unidade">Unidade</option>
                    <option value="pitada">Pitada</option>
                </select>
            </div>
        </div>

        <div class="nav-buttons">
            <button type="submit" class="btn btn-primary">
                ‚ûï Adicionar Ingrediente
            </button>
        </div>
    </form>
</div>

{% if ingredientes %}
    <div class="card">
        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 1.5rem;">
            <h2>üìã Ingredientes da Receita ({{ ingredientes|length }})</h2>
            <span class="total-cost" style="font-size: 1rem; padding: 0.5rem 1rem;">Custo: R$ {{ "%.2f"|format(custo_total) }}</span>
        </div>

        <ul class="item-list">
            {% for ingr in ingredientes %}
                <li class="item-list-item">
                    <div class="item-info">
                        <span class="item-name">{{ ingr['nome'] }}</span>
                        <span class="item-details">- {{ ingr['quantidade'] }} {{ ingr['unidade'] }}</span>
                    </div>
                    <div class="item-actions">
                        <a href="{{ url_for('editar_ingrediente', ingrediente_receita_id=ingr['id']) }}" class="btn btn-small btn-secondary" title="Editar quantidade">
                            ‚úèÔ∏è Editar
                        </a>
                    </div>
                </li>
            {% endfor %}
        </ul>

        <div style="margin-top: 1.5rem; padding-top: 1rem; border-top: 2px solid var(--primary-brown);">
            <div class="total-cost" style="font-size: 1.2rem;">
                üí∞ Custo Total Estimado (Ingredientes): <strong>R$ {{ "%.2f"|format(custo_total) }}</strong>
            </div>
        </div>
    </div>
{% else %}
    <div class="card">
        <div class="empty-state">
            <div class="empty-state-icon">ü•£</div>
            <h3>Nenhum ingrediente adicionado ainda</h3>
            <p>Comece a adicionar ingredientes usando o formul√°rio acima.</p>
            <p>Se um ingrediente n√£o estiver cadastrado, o sistema ir√° pedir-lhe para informar o pre√ßo da embalagem.</p>
        </div>
    </div>
{% endif %}

<div class="nav-buttons">
    <a href="{{ url_for('adicionar_custo_receita', receita_id=receita['id']) }}" class="btn btn-primary">
        Adicionar Custos (G√°s, Embalagens...) ‚Üí
    </a>
    <a href="{{ url_for('ver_receita', receita_id=receita['id']) }}" class="btn btn-success">
        ‚úÖ Finalizar e Ver Resumo
    </a>
    <a href="{{ url_for('editar_receita', receita_id=receita['id']) }}" class="btn btn-secondary">
        ‚úèÔ∏è Editar Nome da Receita
    </a>
    <a href="{{ url_for('index') }}" class="btn btn-secondary">
        üè† Voltar ao In√≠cio
    </a>
</div>

<div class="tip">
    <strong>Como funciona:</strong><br>
    1. Digite o nome do ingrediente. Se n√£o estiver cadastrado, ser√° redirecionado para informar o pre√ßo.<br>
    2. O sistema calcula automaticamente o custo proporcional de cada ingrediente.<br>
    3. Clique em "Editar" ao lado de cada ingrediente para ajustar as quantidades.
</div>
{% endblock %}

{% block scripts %}
<script>
    // Foco autom√°tico no campo de ingrediente
    document.getElementById('nome_ingrediente').focus();

    // Converter para min√∫sculas automaticamente
    document.getElementById('nome_ingrediente').addEventListener('input', function() {
        this.value = this.value.toLowerCase();
    });

    // Preenchimento autom√°tico de unidade com base no ingrediente
    document.getElementById('nome_ingrediente').addEventListener('blur', function() {
        const ingrediente = this.value.toLowerCase();
        const unidadeSelect = document.getElementById('unidade');

        if (ingrediente.includes('farinha') || ingrediente.includes('a√ß√∫car') || ingrediente.includes('chocolate em p√≥')) {
            unidadeSelect.value = 'g';
        } else if (ingrediente.includes('leite') || ingrediente.includes('√°gua') || ingrediente.includes('√≥leo')) {
            unidadeSelect.value = 'ml';
        } else if (ingrediente.includes('ovo')) {
            unidadeSelect.value = 'unidade';
        }
    });
</script>
{% endblock %}
